Сложная бизнес-логика с микросервисами становится ещё сложнее, тк размазана по сервисам

Проблемы:
- нужно избавиться от ссылок на объекты, которые пересекают границв
- ограничения, которые накладывает работа с транзакциями в микросервисах

Решение - использовать паттерны Агрегат из DDD. Это кластер объектов, с которыми можно обращаться, как с единым целым. 
	Транзакция может создать или обновить только один агрегат, что соотв транзакционного модели микросервисов.

Осн шаблоны:
- сценарий транзакции (процедурный) 
- доменная модель (ооп)

Сценарий транзакции - один набор классов реализует поведение, а другой - хранит состояние. 
	Сценарии транзакции организованы в виде классов, у которых нет состояния. 
	Шаблон организует бизнес логику в виде набора процедурных сценариев транзакций, по одному для каждого типа запросов

Доменная модель - организует бизнес логику в виде объектной модели, состоящей из классов с состоянием и поведением. 
	Минус - расплывчатые границы, может возникать рассогласование.

Решение - агрегаты, графы объектов, с которыми можно работать, как с одним целым. Агрегат часто загружается из базы целиком, 
	а удаление агрегата удаляет все его объекты. Обновление целого агрегата решает проблему согласованности.

Правила для работы с агрегатами:
- ссылаться только на корень агрегата
- агрегаты ссылаются друг на друга по первичным ключам, а не ссылкам
- одна транзакция создаёт или обновляет один агрегат

Меньше агрегаты - лучше, но все зависит от контекста и ситуации. Больше размер - легче атомарно обновлять, 
	но труднее декомпозиция по сервисам.

В контексте DDD, событие - это нечто произошедшее с агрегатом. 
	Агрегат публикует доменное событие во время своего создания или в ходе другого существенного изменения.

Доменное событие - это класс, который содержит свойства, которые выразительно передают это событие, например, OrderCreated.

Обогащенные события - это когда события содержат данные, нужные потребителю. Потребители становятся проще, 
	им не надо запрашивать данные у сервиса, но снижается стабильность классов событий

Обмен доменными событиями - разновидность асинхронного общения. В итоге события доходят до брокера в виде сообщений.